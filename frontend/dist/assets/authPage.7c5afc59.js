import{T as t,U as e,_ as o,D as a}from"./index.d949991f.js";import{m as n,J as s,K as i,M as d,L as r,D as u,e as p,G as l,I as c,E as g,y as h,F as _}from"./vendor.a945b803.js";const m=n({name:"InputContainer",components:{},setup:()=>{},props:{prop1:{type:Number},prop2:{type:String}},data:()=>({dataObj:null,data_email:"",data_password:"",data_checkPassword:"",data_isLoading:!1,data_loginMode:!0}),computed:{},watch:{data_loginMode(){this.$emit("authMode",!0===this.data_loginMode?"login":"register")}},created(){},mounted(){},unmounted(){},methods:{submitInput(){return this.data_email&&this.data_password&&(!1!==this.data_loginMode||this.data_checkPassword)?void this.$emit("submitInput",null):t.fail(`${this.$t("ui.auth.emptyFieldWarning")}`)}}}),I=c();s("data-v-2984ccb5");const T={class:"input-container"},b={key:1},A={key:2};i();const y=I(((t,e,o,a,n,s)=>{const i=d("van-switch"),c=d("van-cell");return d("van-field"),d("van-loading"),d("van-button"),r(),u("div",T,[p(c,{class:"",center:"",title:!0===t.data_loginMode?"登入":"註冊"},{"right-icon":I((()=>[p(i,{modelValue:t.data_loginMode,"onUpdate:modelValue":e[1]||(e[1]=e=>t.data_loginMode=e),size:"24"},null,8,["modelValue"])])),_:1},8,["title"]),l("",!0),t.data_loginMode?l("",!0):(r(),u("h4",b,"目前只開放Google帳號註冊")),t.data_loginMode?(r(),u("h4",A,"目前只開放Google帳號登入")):l("",!0)])}));m.render=y,m.__scopeId="data-v-2984ccb5";const E=n({name:"BtnFrame",components:{},setup:()=>{},props:{prop_btnImg:{type:String},prop_btnText:{type:String},prop_loadingStatus:{type:Boolean,default:!1}},data:()=>({dataObj:null,isLoading:!1}),computed:{computed_style:()=>({})},watch:{},created(){},mounted(){},unmounted(){},methods:{}}),f=c();s("data-v-1cf36924");const S={class:"btnFrame"},C={key:0,class:"logoContainer"},U={class:"text"},L={key:0};i();const $=f(((t,e,o,a,n,s)=>{const i=d("van-loading");return r(),u("div",S,[t.prop_loadingStatus?l("",!0):(r(),u("div",C,[p("div",{class:"logo",style:t.computed_style},[p("img",{src:t.prop_btnImg,alt:""},null,8,["src"])],4)])),p("div",U,[t.prop_loadingStatus?l("",!0):(r(),u("p",L,g(t.prop_btnText),1)),t.prop_loadingStatus?(r(),u(i,{key:1,class:"loading",size:"24"})):l("",!0)])])}));E.render=$,E.__scopeId="data-v-1cf36924";const v=n({name:"GoogleAuth",components:{BtnFrame:E},setup:()=>{},props:{prop1:{type:Number},prop2:{type:String},prop_btnType:{type:String,default:"login"}},data:()=>({data_btnImg:"/src/assets/img/icon/oauth/google-login-icon-bubble.svg",data_isLoadingAuthData:!1}),computed:{computed_btnText(){return"login"!==this.prop_btnType?"Sign up with Google":"login"===this.prop_btnType?"Log in with Google":void 0}},watch:{data_isLoadingAuthData(){this.$emit("isLoadingAuthData",this.isLoadingAuthData)}},created(){},mounted(){},unmounted(){},methods:{async handleClickSignIn(){this.data_isLoadingAuthData=!0;try{const o=await this.$gAuth.signIn();if(!o)return null;this.user=o.getBasicProfile().getEmail();const a=o.getAuthResponse().id_token;this.axios({method:"POST",url:"https://www.animal-crossing.me/api/auth/signup/google",data:{idToken:a}}).then((o=>{const a=o.data;200===o.status&&(this.$store.dispatch(`user/${e.SET_IF_AUTHENTICATED}`,!0),this.$store.dispatch(`user/${e.SET_AUTHENTICATION_VALID}`,a.tokenIsValidUntil),this.data_isLoadingAuthData=!1,t.success("登入成功!"),console.log("auth OK"),setTimeout((()=>{location.assign("/")}),800))}))}catch(o){console.log("auth failed"),console.error(o),this.$store.dispatch(`user/${e.SET_IF_AUTHENTICATED}`,!1),this.$store.dispatch(`user/${e.SET_AUTHENTICATION_VALID}`,null),this.data_isLoadingAuthData=!1,"popup_closed_by_user"===o.error&&t.fail("取消登入"),"popup_closed_by_user"!==o.error&&t.fail("登入失敗，請稍後再試")}}}}),k=c()(((t,e,o,a,n,s)=>{const i=d("BtnFrame");return r(),u(i,{onClick:t.handleClickSignIn,prop_btnImg:t.data_btnImg,prop_btnText:t.computed_btnText,prop_loadingStatus:t.data_isLoadingAuthData},null,8,["onClick","prop_btnImg","prop_btnText","prop_loadingStatus"])}));v.render=k,v.__scopeId="data-v-e1ccb626";const w=n({name:"AuthComponent",components:{SectionComponent:o,InputContainer:m,GoogleAuthBtn:v},setup:()=>{},props:{prop1:{type:Number},prop2:{type:String},prop_inputType:{type:String}},data:()=>({dataObj:null,data_sendingAuthData:!1,data_authBtnType:"login",data_isRedirectingToOtherPage:!1}),computed:{computed_ifUserIsLoggedIn(){const t=this.$store.getters[`user/${e.GET_IF_AUTHENTICATED}`];return console.log("ifUserIsLoggedIn",t),t}},watch:{},created(){},mounted(){},unmounted(){},methods:{submitInputHandler(t){console.log("submitInputHandler:",t)},authModeControll(t){if("login"!==t&&"register"!==t)return console.warn("authMode is not valid"),this.data_authBtnType="login";this.data_authBtnType=t},confirmLogout(){const o=window.confirm(`${this.$t("ui.auth.confirmToLogout")}`);o&&a.get("https://www.animal-crossing.me/api/auth/logout",{headers:{CLIENT_REQ:"Vue.js AUTH PAGE: CHECK IF USER HAS LOGGED IN"}}).then((o=>{const a=o.status;console.log("傳回的代號status ",a),200===a&&(t.success(`${this.$t("ui.result.success")}`),this.$store.dispatch(`user/${e.SET_IF_AUTHENTICATED}`,!1),this.$store.dispatch(`user/${e.SET_DATA_OF_CURRENT_USER}`,null),this.data_isRedirectingToOtherPage=!0,setTimeout((()=>{location.assign("/")}),1e3))})),o||t.fail(`${this.$t("ui.button.cancel")}`)}}}),D=c();s("data-v-7af6bbe5");const N={key:0,class:"loginContainer"},H={key:1,class:"loginContainer"},F={key:2,class:"loginContainer"};i();const G=D(((t,e,o,a,n,s)=>{const i=d("InputContainer"),c=d("GoogleAuthBtn"),m=d("van-button");return r(),u(_,null,[t.computed_ifUserIsLoggedIn||t.data_isRedirectingToOtherPage?l("",!0):(r(),u("div",N,[p(i,{onSubmitInput:t.submitInputHandler,onAuthMode:t.authModeControll},null,8,["onSubmitInput","onAuthMode"]),p(c,{prop_btnType:t.data_authBtnType},null,8,["prop_btnType"])])),t.data_isRedirectingToOtherPage?(r(),u("div",H,[p("h2",null,g(t.$t("ui.auth.redirectToHome"))+" ...",1)])):l("",!0),t.computed_ifUserIsLoggedIn?(r(),u("div",F,[p(m,{color:"linear-gradient(to right, #ff6034, #ee0a24)",onClick:t.confirmLogout},{default:D((()=>[h(g(t.$t("ui.auth.logout")),1)])),_:1},8,["onClick"])])):l("",!0)],64)}));w.render=G,w.__scopeId="data-v-7af6bbe5";const M=n({name:"authPage",components:{Section:o,AuthComponent:w,SignUp:{}},setup:()=>{},props:{prop1:{type:Number},prop2:{type:String}},data:()=>({dataObj:null,data_checkingIfUserIsLoggedIn:!0}),computed:{computed_ifUserIsLoggedIn(){const t=this.$store.getters[`user/${e.GET_IF_AUTHENTICATED}`];return console.log("ifUserIsLoggedIn",t),t}},watch:{},created(){},mounted(){this.computed_ifUserIsLoggedIn||a.get('https://www.animal-crossing.me/api/user/currentUser?getUserData="true"',{headers:{CLIENT_REQ:"Vue.js AUTH PAGE: CHECK IF USER HAS LOGGED IN"}}).then((t=>{const o=t.data;console.log("currentUser:",o),this.$store.dispatch(`user/${e.SET_IF_AUTHENTICATED}`,!!o),this.$store.dispatch(`user/${e.SET_DATA_OF_CURRENT_USER}`,o||null),this.data_checkingIfUserIsLoggedIn=!1})),this.computed_ifUserIsLoggedIn&&(this.data_checkingIfUserIsLoggedIn=!1)},unmounted(){},methods:{}}),O=c();s("data-v-77c98812");const R={key:0,class:"checkingUserLogInStatus"},x=p("h4",null,"Checking if user has logged in...",-1);i();const B=O(((t,e,o,a,n,s)=>{const i=d("van-loading"),c=d("AuthComponent"),g=d("Section");return r(),u(g,{props_title:t.$t("ui.auth.auth"),props_subtitle:"",class:"authContainer"},{default:O((()=>[t.data_checkingIfUserIsLoggedIn?(r(),u("div",R,[x,p(i,{type:"circular",color:"#5676d8",size:"30px"})])):l("",!0),t.data_checkingIfUserIsLoggedIn?l("",!0):(r(),u(c,{key:1}))])),_:1},8,["props_title"])}));M.render=B,M.__scopeId="data-v-77c98812";export default M;
